ko.computed=ko.dependentObservable=function(e,t,n){function c(e,t,n){if(f&&t===m)throw Error("A 'pure' computed must not be called recursively");N[e]=n,n._order=C++,n._version=t.getVersion()}function h(){var e,t;for(e in N)if(N.hasOwnProperty(e)){t=N[e];if(t._target.hasChanged(t._version))return!0}}function p(){!l&&N&&ko.utils.objectForEach(N,function(e,t){t.dispose&&t.dispose()}),N=null,C=0,u=!0,i=!1,l=!1}function d(){var e=m.throttleEvaluation;e&&e>=0?(clearTimeout(k),k=setTimeout(function(){v(!0)},e)):m._evalRateLimited?m._evalRateLimited():v(!0)}function v(e){if(s)return;if(u)return;if(x&&x()){if(!o){T();return}}else o=!1;s=!0;try{var n=N,h=C,p=f?undefined:!C;ko.dependencyDetection.begin({callback:function(e,t){u||(h&&n[t]?(c(t,e,n[t]),delete n[t],--h):N[t]||c(t,e,l?{_target:e}:e.subscribe(d)))},computed:m,isInitial:p}),N={},C=0;try{var v=t?a.call(t):a()}finally{ko.dependencyDetection.end(),h&&!l&&ko.utils.objectForEach(n,function(e,t){t.dispose&&t.dispose()}),i=!1}m.isDifferent(r,v)&&(l||b(r,"beforeChange"),r=v,DEBUG&&(m._latestValue=r),l?m.updateVersion():e&&b(r)),p&&b(r,"awake")}finally{s=!1}C||T()}function m(){if(arguments.length>0){if(typeof w!="function")throw new Error("Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.");return w.apply(t,arguments),this}return ko.dependencyDetection.registerDependency(m),(i||l&&h())&&v(),r}function g(){return(i&&!C||l&&h())&&v(),r}function y(){return i||C>0}function b(e,t){m.notifySubscribers(e,t)}var r,i=!0,s=!1,o=!1,u=!1,a=e,f=!1,l=!1;a&&typeof a=="object"?(n=a,a=n.read):(n=n||{},a||(a=n.read));if(typeof a!="function")throw new Error("Pass a function that returns the value of the ko.computed");var w=n.write,E=n.disposeWhenNodeIsRemoved||n.disposeWhenNodeIsRemoved||null,S=n.disposeWhen||n.disposeWhen,x=S,T=p,N={},C=0,k=null;t||(t=n.owner),ko.subscribable.call(m),ko.utils.setPrototypeOfOrExtend(m,ko.dependentObservable.fn),m.peek=g,m.getDependenciesCount=function(){return C},m.hasWriteFunction=typeof w=="function",m.dispose=function(){T()},m.isActive=y;var L=m.limit;return m.limit=function(e){L.call(m,e),m._evalRateLimited=function(){m._rateLimitedBeforeChange(r),i=!0,m._rateLimitedChange(m)}},n.pure?(f=!0,l=!0,m.beforeSubscriptionAdd=function(e){if(!u&&l&&e=="change"){l=!1;if(i||h())N=null,C=0,i=!0,v();else{var t=[];ko.utils.objectForEach(N,function(e,n){t[n._order]=e}),ko.utils.arrayForEach(t,function(e,t){var n=N[e],r=n._target.subscribe(d);r._order=t,r._version=n._version,N[e]=r})}u||b(r,"awake")}},m.afterSubscriptionRemove=function(e){!u&&e=="change"&&!m.hasSubscriptionsForEvent("change")&&(ko.utils.objectForEach(N,function(e,t){t.dispose&&(N[e]={_target:t._target,_order:t._order,_version:t._version},t.dispose())}),l=!0,b(undefined,"asleep"))},m._originalGetVersion=m.getVersion,m.getVersion=function(){return l&&(i||h())&&v(),m._originalGetVersion()}):n.deferEvaluation&&(m.beforeSubscriptionAdd=function(e){(e=="change"||e=="beforeChange")&&g()}),ko.exportProperty(m,"peek",m.peek),ko.exportProperty(m,"dispose",m.dispose),ko.exportProperty(m,"isActive",m.isActive),ko.exportProperty(m,"getDependenciesCount",m.getDependenciesCount),E&&(o=!0,E.nodeType&&(x=function(){return!ko.utils.domNodeIsAttachedToDocument(E)||S&&S()})),!l&&!n.deferEvaluation&&v(),E&&y()&&E.nodeType&&(T=function(){ko.utils.domNodeDisposal.removeDisposeCallback(E,T),p()},ko.utils.domNodeDisposal.addDisposeCallback(E,T)),m},ko.isComputed=function(e){return ko.hasPrototype(e,ko.dependentObservable)};var protoProp=ko.observable.protoProperty;ko.dependentObservable[protoProp]=ko.observable,ko.dependentObservable.fn={equalityComparer:valuesArePrimitiveAndEqual},ko.dependentObservable.fn[protoProp]=ko.dependentObservable,ko.utils.canSetPrototype&&ko.utils.setPrototypeOf(ko.dependentObservable.fn,ko.subscribable.fn),ko.exportSymbol("dependentObservable",ko.dependentObservable),ko.exportSymbol("computed",ko.dependentObservable),ko.exportSymbol("isComputed",ko.isComputed),ko.pureComputed=function(e,t){return typeof e=="function"?ko.computed(e,t,{pure:!0}):(e=ko.utils.extend({},e),e.pure=!0,ko.computed(e,t))},ko.exportSymbol("pureComputed",ko.pureComputed);